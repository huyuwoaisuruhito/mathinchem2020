\chapter{多自由度小振动}
    \section{将平衡位置附近的势能函数展开为二次型}
    现在研究复杂一些的\ce{H2O}分子的振动。它总共有3个原子，所以有9个运动自由度。质心平动3个自由度，
    刚性转动也有3个自由度，因此振动是3个自由度。
    \footnote{
    3个振动自由度分别为剪切振动、对称伸缩振动和不对称伸缩振动。
    水分子的O-H振动波数约为3700 cm$^{-1}$, 剪切振动波数约为1600 cm$^{-1}$, 
    伸缩振动1个周期应当约为20.8 fs, 剪切振动周期约为9 fs. 而1 a.u. = 0.024 fs.即可据此估计模拟过程中的时间步长。\\
    多原子分子的振动问题比表面上看起来更加复杂。对于刚体，
    有三个平动自由度与三个转动自由度，可以通过描述质心坐标与刚体的旋转
    （特殊正交矩阵描述，3个自由度）来确定整个刚体的运动。对于分子来说，振动和转动
    通常是耦合的，并不能严格定义转动自由度，但是在\textbf{小振动}的情形下，可以分离
    平动、转动、振动自由度，略微下详细的讨论可以参见\cite{Landau2007mechanics}，
    这里不再展开。
    }
    对于水分子，定义每个原子的坐标为：
    \begin{equation}
        \begin{split}
        \bm{x} = 
        \begin{pmatrix}
            \bm{x}_\mathrm{O}\\
            \bm{x}_{\mathrm{H1}}\\
            \bm{x}_{\mathrm{H2}}
        \end{pmatrix}
    \end{split}
    \end{equation}
    其中$\bm{x}_\mr{O}$表示氧原子O在三维空间中的Descartes坐标，其他以此类推。
    给定原子核运动的势能$V(\bm{x})$, 定义质量矩阵：
    \begin{equation}
        \begin{split}
        \bm{M} = \mathrm{diag} \{m_1,...,m_9 \} = 
        \begin{pmatrix}
            m_1 & \cdots & 0\\
            \vdots & \ddots & \vdots\\
            0 & \cdots & m_9
        \end{pmatrix}
        \label{mass matrix}
    \end{split}
    \end{equation}
    其中，$m_1,m_2,m_3$等于氧原子的质量，$m_4,...,m_9$等于氢原子的质量。那么可以将
    系统的动量表示为：
    \begin{equation}
        \bm{p} = \bm{M}\cdot\dot{\bm{x}}
    \end{equation}
    仿照一维系统的Hamilton量，可以写出这个多维系统的Hamilton量：
    \begin{equation}
        H(\bm{x}, \bm{p}) = \frac{1}{2}\bm{p}^{\mr{t}}\bm{M}^{-1}\bm{p} + V(\bm{x})
    \end{equation}
    理论上，只要给出势能函数的形式，就可以完全讨论系统的运动。但是对于系统在平衡位置
    \footnote{一般都是指稳定平衡位置，即当系统偏离平衡点的距离非常微小时，
    系统有回到平衡位置的运动趋势，数学上对应势能函数的\textbf{极小值点}
    }附近的运动，通常采用\textbf{小振动近似}来得到系统在平衡位置附近运动的解析表达式。
    假设平衡位置为$\bm{x_{\mr{eq}}}$，那么在平衡点邻域内的函数值可以按照Taylor展开写为：
    \begin{equation}
        \begin{split}
        V(\bm{x_{\mr{eq}}} + \bm{q}) &= V(\bm{x_{\mr{eq}}}) + \left.\pdv{V}{\bm{x}}\right|_{\bm{x} = \bm{x}_{\mr{eq}}}^{\mr{t}}\bm{q}
         + \frac{1}{2}\bm{q}^{\mr{t}}\left.\pdv{^2V}{\bm{x}^2}\right|_{\bm{x} = \bm{x_{\mr{eq}}}}\bm{q} + o(\left|\bm{q}\right|^2)\\
        \end{split}
    \end{equation}
    显然在平衡位置$\dps\left.\pdv{V}{\bm{x}}\right|_{\bm{x} = \bm{x}_{\mr{eq}}}$
    为0（从数学上讲，这是函数极小值点的性质；从物理上讲，平衡位置处系统不受力）；
    同时常数项不会影响运动方程，可以不予考虑；如果在$\bm{q}$比较小时，忽略2阶以上的项
    \footnote{这就是小振动近似，但是前提我们假设了Taylor展开的二阶项存在。但是，
    对于稳定平衡（极小值点）附近的Taylor展开，完全可能出现二阶项为0的情形，
    比如势能是四次函数，这时使用小振动图像得到的结论就会完全出错。
    }
    ，那么就可以将势能函数重写为：
    \begin{equation}
        V(\bm{q}) = \frac{1}{2}\bm{q}^{\mr{t}}\left.\pdv{^2V}{\bm{x}^2}\right|_{\bm{x} = \bm{x}_{\mr{eq}}}\bm{q}
        \label{potential at equilibrium point}
    \end{equation}
    定义矩阵（通常而言是一个半正定
    \footnote{
        一般而言这个矩阵一定有0作为特征值。因为分子在某些
        自由度运动时（刚性转动、质心平动）分子的势能不变，这说明在势能极小值处
        沿着某些方向运动时势能函数恒定。可以说明代表分子整体平移的矢量是此矩阵特征值为0
        的特征向量，但是对于分子的转动，不一定会对应一个特征值为0的特征向量？
    }
    的实对称矩阵）：
    \begin{equation}
        \bm{K} = \left.\pdv{^2V}{\bm{x}^2}\right|_{\bm{x} = \bm{x}_{\mr{eq}}}
        \label{potential matrix}
    \end{equation}
    那么系统在平衡位置的Hamilton量可以写为：
    \begin{equation}
        H(\bm{q}, \bm{p}) = \frac{1}{2}\bm{p}^{\mr{t}}\bm{M}^{-1}\bm{p} + \frac{1}{2}\bm{q}^{\mr{t}}\bm{K}\bm{q}
        \label{the Hamiltonian of samll vibration}
    \end{equation}
    其中$\bm{q}$为：
    \begin{equation}
        \bm{q} = \bm{x} - \bm{x_{\mr{eq}}}
    \end{equation}
    表示偏移平衡点的位移。

    \section{简正坐标}
    对于更一般的情况，质量矩阵$\bm{M}$不一定是对角的，但一定是实对称且正定的矩阵
    \footnote{对于非直角坐标，比如在某些约束下定义的广义坐标，$\bm{M}$并不对角，
    但是由于动能只可能是正值，所以$\bm{M}$一定正定}
    ，这样就可以唯一地定义它正定的平方根$\bm{M}^{\frac{1}{2}}$
    \footnote{这也是一个实对称矩阵，结论可以通过对角化这个矩阵来理解，详细的证明要参考线性代数教材}，
    将Hamilton量\ref{the Hamiltonian of samll vibration}写为：
    \begin{equation}
        H(\bm{q},\bm{p}) = \frac{1}{2}\left(\bm{M}^{-\frac{1}{2}}\bm{p}\right)^\mr{t}\bm{M}^{-\frac{1}{2}}\bm{p} + 
        \frac{1}{2}\left(\bm{M}^{\frac{1}{2}}\bm{q}\right)^{t}\bm{M}^{-\frac{1}{2}}\bm{K}\bm{M}^{-\frac{1}{2}}\left(\bm{M}^{\frac{1}{2}}\bm{q}\right)
    \end{equation}
    定义\textbf{Hessian}矩阵$\bm{\mathcal{H}}$为 
    \begin{equation}
        \begin{split}
            \bm{\mathcal{H}} = \bm{M}^{-\frac{1}{2}}\bm{K}\bm{M}^{-\frac{1}{2}}
        \end{split}
        \label{Hessian matrix}
    \end{equation}
    它的量纲为s$^{-2}$. 显然这是一个实对称矩阵，可以由正交矩阵作对角化：
    \begin{equation}
        \bm{\mathcal{H}} = \bm{S}\bm{\bm{\Omega}S}^{\mr{t}}
    \end{equation}
    其中$\bm{\Omega}$为一个对角矩阵，$\bm{S}$为\textbf{正交矩阵}
    \footnote{
        正交矩阵满足: 
    \begin{equation}
        \bm{S}^\mathrm{t}\bm{S} = \bm{SS}^\mathrm{t} = \bm{I}
    \end{equation}
    }
    ，其列向量为$\bm{\mathcal{H}}$的特征向量，
    令：
    \begin{equation}
        \bm{\Omega} = \mathrm{diag} \{\omega_1^2, ..., \omega_N^2 \}
    \end{equation}
    这样就得到了$N$个（$N$为系统的总自由度数目）具有频率量纲的常数，后面会讨论
    其物理含义。利用上面定义的矩阵，可以继续改写系统的Hamilton量：
    \begin{equation}
        H(\bm{q},\bm{p}) = \frac{1}{2}\left(\bm{S}^\mr{t}\bm{M}^{-\frac{1}{2}}\bm{p}\right)^\mr{t}\left(\bm{S}^\mr{t}\bm{M}^{-\frac{1}{2}}\bm{p}\right) + 
        \frac{1}{2}\left(\bm{S}^\mr{t}\bm{M}^{\frac{1}{2}}\bm{q}\right)^{t}\bm{\Omega}\left(\bm{S}^\mr{t}\bm{M}^{\frac{1}{2}}\bm{q}\right)
    \end{equation}
    利用上面Hamilton量的形式，定义如下相空间中的\textbf{坐标变换}（简正坐标变换）：
    \begin{equation}
        \left\{
        \begin{split}
            \bm{Q} &= \bm{S}^\mr{t}\bm{M}^{\frac{1}{2}}\bm{q}\\
            \bm{P} &= \bm{S}^\mr{t}\bm{M}^{-\frac{1}{2}}\bm{p}
        \end{split}
        \right.
        \label{normal mode transformation}
    \end{equation}
    这样就可以将Hamilton量表示为：
    \begin{equation}
        \begin{split}
        H(\bm{Q},\bm{P}) &= \frac{1}{2}\bm{P}^{\mr{t}}\bm{P} + \frac{1}{2}\bm{Q}^{\mr{t}}\bm{\Omega}\bm{Q}\\
        & = \frac{1}{2}\sum_{i=1}^{N}P_{i}^2 + \frac{1}{2}\sum_{i=1}^{N}\omega_{i}^2Q_{i}^{2}
        \end{split}
    \end{equation}
    表面上看起来这是$N$个不耦合（之间没有相互作用）的简谐振子的Hamilton量，
    其解有简单的形式（在第一章中我们讨论了这个问题）。\textbf{但是}，
    这里忽略了一个重要的问题：坐标变换之后的新变量$(\bm{Q},\bm{P})$
    与对应的Hamilton量$H(\bm{Q},\bm{P})$是否满足Hamilton方程？
    \par 
    在此处\textbf{不打算}完全解决这个问题，只给出此问题的一个严谨的表述，
    目的是清楚地认识到上面的变换并不是随意进行的，而是一种特殊的变换。
    考虑一个系统A的运动可以由Hamilton量$H(\bm{q},\bm{p},t),\,\,(\bm{q},\bm{p})\in\mathbb{R}^{2N}$
    与对应的Hamilton方程来描述，考虑相空间中的一个可逆变换：$\rho:(\bm{q},\bm{p})\mapsto(\bm{Q}, \bm{P}),\,\,\mathbb{R}^{2N}\to\mathbb{R}^{2N}$
    （其中$t$为时间，也可以将其理解为任意参数）
    \begin{equation}
        \left\{
        \begin{split}
            Q_i &= Q_i(\bm{q},\bm{p}, t)\\
            P_i &= P_i(\bm{q}, \bm{p}, t)
        \end{split}
        \right.
    \end{equation}
    这样的变换可以很丰富，比前面讨论的简正坐标变换\ref{normal mode transformation}，
    这是相空间中不包含时间的一个线性变换；还有在第二章讨论过的Hamilton方程的解所定义的
    不同时刻轨线上的点之间的映射$\phi^{\tau}:(\bm{q}_{t},\bm{p}_{t})\mapsto(\bm{q}_{t+\tau},\bm{p}_{t+\tau})$。
    如果存在一个函数$K(\bm{Q}, \bm{P}, t)$能够让变换之后的坐标满足
    （即$K(\bm{Q}, \bm{P}, t)$\textbf{对应的}Hamilton方程等价于$H(\bm{q},\bm{p},t)$
    \textbf{对应的}Hamilton方程所描述的运动）：
    \begin{equation}
        \left\{
        \begin{split}
            \dot{Q_i} &= \pdv{K}{P_i}\\
            \dot{P_{i}} &= -\pdv{K}{Q_i}
        \end{split}
        \right.
    \end{equation}
    那么称这样的变换为\textbf{正则变换}，前面提到的两种变换都是正则变换。
    \footnote{
        一个变换是正则变换的充要条件是满足：
        \begin{equation}
            \left[\pdv{(\bm{Q},\bm{P})}{(\bm{q}, \bm{p})}\right]^{\mr{t}}\bm{J}\pdv{(\bm{Q},\bm{P})}{(\bm{q}, \bm{p})} = \bm{J}
        \end{equation}
        其中$\pdv{(\bm{Q},\bm{P})}{(\bm{q}, \bm{p})}$是正则变换的Jacobi矩阵，它可以是时间的函数，$\bm{J}$为
        标准辛矩阵。可以通过这个验证文中所述的变换为正则变换。
        正则变换极大地拓展了Hamilton力学的内涵，导出了很多在数学和物理上有深刻意义的结论，
        比如之前详细讨论的Liouville定理，就可以看作是正则变换不改变相空间体积的一个特例，
        详细的介绍可以参考\cite{Goldstein2000Classical}。
    }
    对于任意的相空间中的变换，“新Hamilton量”$K$的存在性是无法保证的，
    考虑新坐标对于时间的导数（方便起见，此处使用求和约定）：
    \begin{equation}
        \left\{
            \begin{split}
                \dot{Q_i} &= \pdv{Q_i}{q_{j}}\dot{q_{j}} + \pdv{Q_i}{p_j}\dot{p_j}
                + \pdv{Q_i}{t} = \{Q_i, H\}_{\bm{q},\bm{p}} + \pdv{Q_i}{t}\\
                \dot{P_i} &= \pdv{P_i}{q_{j}}\dot{q_{j}} + \pdv{P_i}{p_j}\dot{p_j}
                + \pdv{P_i}{t} = \{P_i, H\}_{\bm{q},\bm{p}} + \pdv{P_i}{t}
            \end{split}
        \right.
        \label{the derivative of new coordinate}
    \end{equation}
    等式\ref{the derivative of new coordinate}右边为$(\bm{q},\bm{p},t)$的函数，可以想象
    ，对于任意的变换，并不一定可以找到$K(\bm{Q},\bm{P},t)$使得等式右边与
    $\pdv{K}{P_{i}},-\pdv{K}{Q_i}$对应相等。
    \par 

    回到水分子的振动问题，水分子的势能函数在谐振子近似下为：
    \begin{equation}
        \begin{split}
        V(\bm{x}) &= V(\bm{x}_\mathrm{eq}) + \frac 12 (\bm{x-x}_\mathrm{eq})^\mathrm{T} \bm{V}^{(2)} (\bm{x-x}_\mathrm{eq})\\
        &= V(\bm{x}_\mathrm{eq}) + \frac 12 (\bm{x-x}_\mathrm{eq})^\mathrm{T} \bm{M}^{\frac 12}\bm{\mathcal{H}} \bm{M}^{\frac 12} (\bm{x-x}_\mathrm{eq})\\
        &= V(\bm{x}_\mathrm{eq}) + \frac 12 (\bm{x-x}_\mathrm{eq})^\mathrm{T} \bm{M}^{\frac 12} \bm{T\Omega T}^\mathrm{T} \bm{M}^{\frac 12} (\bm{x-x}_\mathrm{eq})
        \end{split}
    \end{equation}
    定义\textbf{简正坐标}$\bm{Q}$：
    \begin{equation}
        \bm{Q} = \bm{T}^\mathrm{T} \bm{M}^{\frac 12} (\bm{x-x}_\mathrm{eq})
    \end{equation}
    于是稳定平衡点附近的势能面可以表示为：
    \begin{equation}
        V(\bm{Q}) = V(\bm{0}) + \frac 12 \bm{Q}^\mathrm{T} \bm{\Omega Q} = V(\bm{0}) + \sum_{j=1}^N \frac 12 \omega_j^2 Q_j^2
    \end{equation}

    \section{简正坐标和Cartesian坐标的关系}
    上一节讨论了势能在简正坐标下的形式。要想得到全能量，还需要给出动量在简正坐标下的形式。根据
    \begin{equation}
        \bm{p} = \bm{M\dot{x}} = \bm{M}^{\frac 12} \bm{T\dot{Q}}
    \end{equation}
    这是在Cartesian坐标系下的动量。定义简正坐标下的动量为
    \begin{equation}
        \bm{P = \dot{Q}} = \bm{T}^\mathrm{T} \bm{M}^{-\frac 12} \bm{p}
    \end{equation}
    那么，可以得到动能的表达式为
    \begin{equation}\begin{aligned}
        E_\mathrm{k} = \frac 12 \bm{p}^{\mathrm{T}} \bm{M}^{-1} \bm{p} &= \frac 12 \bm{\dot{x}}^\mathrm{T}\bm{M\dot{x}}
        = \frac 12 \bm{\dot{Q}}^\mathrm{T} \bm{Q}
        = \frac 12 \bm{P}^{\mathrm{T}} \bm{P}
    \end{aligned}\end{equation}
    总结简正坐标和Cartesian坐标的变换：
    \begin{equation}\begin{aligned}
        \bm{Q} &= \bm{T}^\mathrm{T} \bm{M}^{\frac 12} (\bm{x-x}_\mathrm{eq})\\
        \bm{P} &= \bm{T}^\mathrm{T} \bm{M}^{-\frac 12} \bm{p}\\
        \bm{x} &= \bm{x}_\mathrm{eq} + \bm{M}^{-\frac 12}\bm{TQ}\\
        \bm{p} &= \bm{M}^{\frac 12}\bm{TP}
    \end{aligned}\end{equation}

    有了简正坐标下的动量就可以得到简正坐标下的Hamilton函数：
    \begin{equation}
        H = \frac 12 \bm{P}^\mathrm{T}\bm{P} + \frac 12 \bm{Q}^\mathrm{T} \bm{\Omega Q}
    \end{equation}
    很容易可以验证，正则方程在简正坐标下依旧成立：
    \begin{equation}\begin{aligned}
        \bm{\dot{Q}} &= \frac {\partial H}{\partial \bm{P}} = \bm{P}\\
        \bm{\dot{P}} &= -\frac {\partial H}{\partial \bm{Q}} = -\bm{\Omega Q}
    \end{aligned}\end{equation}
    要求出每个元素的值也十分容易：
    \begin{equation}\begin{aligned}
        \dot{Q}_j &= P_j\\
        \dot{P}_j &= - \omega_j^2 Q_j
    \end{aligned}\end{equation}
    但如果在Cartesian坐标下用正则方程，得到每个元素的值结果为
    \begin{equation}\begin{aligned}
        \dot{x}_i &= \frac {p_j}{m_i}\\
        \dot{p}_i &= \sum_j \frac {\partial^2 V}{\partial x_i \partial x_j} (x_j - x_\mathrm{eq}^{(j)})
    \end{aligned}\end{equation}
    显然要比在简正坐标下的形式要复杂很多。这体现了简正坐标的优势。

    我们可以根据初始条件$(\bm{x}_0,\bm{p}_0)$，得到$(\bm{x},\bm{p}$每个分量的解析表达式。将它变换为简正坐标，得到
    \begin{equation}\begin{aligned}
        Q_j &= \sum_i T_{ij} m_i^{\frac 12} (x_0^{(i)} - x_\mathrm{eq}^{(i)})\\
        P_j &= \sum_i T_{ij} m_i^{-\frac 12} (p_0^{(i)})
    \end{aligned}\end{equation}
    由正则方程的形式可以给出
    \begin{equation}\begin{aligned}
        Q_j(t) &= Q_0^{(j)}\cos{\omega_j t} + \frac {P_0^{(j)}}{\omega} \sin{\omega_j t}\\
        P_j(t) &= P_0^{(j)}\cos{\omega_j t} - \omega_j Q_0^{(j)} \sin{\omega_j t}
    \end{aligned}\end{equation}
    再变换回Cartesian坐标，得到
    \begin{equation}\begin{aligned}
        x_i(t) - x_\mathrm{eq}^{(i)} &= \sum_j m_j^{-\frac 12} T_{ij} Q_j(t)\\
        p_i(t) &= \sum_j m_j^{\frac 12} T_{ij}P_j(t)
    \end{aligned}\end{equation}

    如果水分子服从Boltzmann分布，即
    \begin{equation}\begin{aligned}
        \rho \propto \mathrm{e}^{-\beta (\frac 12 \bm{P}^\mathrm{T}\bm{P} + \frac 12 \bm{Q}^\mathrm{T} \bm{\Omega Q})} = \mathrm{e}^{- \frac {\beta}2 \sum_j (P_j^2 + \omega_j^2 Q_j^2)} = \prod_j \mathrm{e}^{-\frac {\beta}2 (P_j^2 + \omega_j^2 Q_j^2)}
    \end{aligned}\end{equation}
    要想将Cartesian坐标下的积分变换成简正坐标下的积分，需要计算Jacobi行列式：
    \begin{equation}\begin{aligned}
        \bigg|\frac {\partial (\bm{Q,P})}{\partial (\bm{x,p})}\bigg| &= \det
        \begin{pmatrix}
            \bm{T}^\mathrm{T}\bm{M}^{\frac 12} & 0\\
            0 & \bm{T}^\mathrm{T}\bm{M}^{-\frac 12}
        \end{pmatrix}
        = 1
    \end{aligned}\end{equation}
    这里用到了正交矩阵的行列式为1（这也是显然成立的）。因此可以积分得到配分函数，从而得到简正坐标下的某个分量概率密度为
    \begin{equation}
        \mathcal{P}_j = \frac {2\pi}{\beta\omega_j} \mathrm{e}^{-\frac {\beta}2 (P_j^2 + \omega_j^2 Q_j^2)}
    \end{equation}
    总概率密度为
    \begin{equation}
        \mathcal{P} = \prod_j \mathcal{P}_j
    \end{equation}
    由此可以得到Cartesian坐标下概率密度。

    \section{Homework}
    \begin{asg}
        证明Hessian矩阵的本征值都是实数。
    \end{asg}
    \begin{asg}
        给定水分子简正坐标下的初始系综密度函数，求键长、键角
        的期望和涨落随时间的变化。
    \end{asg}


    \bibliographystyle{plain}
    \bibliography{ref_chp_4}
